<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPS AR Demo</title>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false;"
  >
    <a-camera gps-camera rotation-reader></a-camera>

    <!-- 指定した緯度経度の位置に円筒を配置 -->
    <a-cylinder
      position="0 0 0"
      radius="1"
      height="3"
      color="red"
      gps-entity-place="latitude: 35.6684025; longitude: 139.7919404;"
    ></a-cylinder>

    <!-- カメラの向きを示すテキスト -->
    <a-text
      value="カメラの方向を確認"
      look-at="[gps-camera]"
      scale="5 5 5"
      position="0 4 -5"
    ></a-text>
  </a-scene>

  <script>
    // 緯度経度を3D座標に変換する関数
    function latLonToVector3(lat, lon) {
      const scale = 0.00001; // スケールを調整
      const R = 6371e3; // 地球の半径 (メートル)
      const φ = lat * Math.PI / 180; // 緯度をラジアンに変換
      const λ = lon * Math.PI / 180; // 経度をラジアンに変換

      const x = R * λ * Math.cos(φ); // 緯度経度からX座標を計算
      const y = 0; // Y座標は地面と一致
      const z = R * φ; // 緯度経度からZ座標を計算

      return new THREE.Vector3(x * scale, y, z * scale); // スケールを適用して3D座標を返す
    }
  </script>
</body>
</html>
